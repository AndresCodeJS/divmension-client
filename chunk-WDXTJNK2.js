import"./chunk-U2MVLE3G.js";import{a as G,b as $}from"./chunk-F4X5JNGB.js";import{a as R}from"./chunk-YMVYKCWO.js";import{a as k}from"./chunk-UU4EZ7QN.js";import{a as q,b as A,c as H}from"./chunk-DMHFH6UV.js";import{a as K,c as Z}from"./chunk-7ZP25VSS.js";import{a as N}from"./chunk-RO4JG6DJ.js";import{b as O}from"./chunk-OARA3AYC.js";import{$a as z,Ja as m,La as b,Na as S,Pa as p,Qa as I,Ra as U,Rb as Q,Sa as o,T as g,Ta as l,Ua as u,Ub as M,Va as C,Wa as x,X as V,Xa as d,Ya as E,Za as L,_a as j,ab as c,bb as h,cb as T,da as f,ea as _,fa as w,gb as B,hb as D,ua as P,xa as a,ya as v}from"./chunk-BMN75HSZ.js";import{f as y}from"./chunk-KAWQVD33.js";var J=["postCardContainer"],W=(t,r)=>r.postId;function X(t,r){if(t&1&&u(0,"img",8),t&2){let e=d(3);E("src",e.user.photoUrl,P)}}function Y(t,r){t&1&&u(0,"img",8),t&2&&E("src","/sin-perfil.jpg",P)}function ee(t,r){if(t&1){let e=C();o(0,"div",23),x("click",function(){f(e);let i=d(4);return _(i.unfollowUser())}),o(1,"button",24),c(2," Unfollow "),l()()}}function te(t,r){if(t&1){let e=C();o(0,"div",22)(1,"button",25),x("click",function(){f(e);let i=d(4);return _(i.followUser())}),c(2," Follow "),l()()}}function ie(t,r){if(t&1&&m(0,ee,3,0,"div",22)(1,te,3,0,"div",22),t&2){let e=d(3);p(e.isFollowing?0:1)}}function oe(t,r){if(t&1){let e=C();o(0,"button",28),x("click",function(){f(e);let i=d(4);return _(i.triggerFileInput())}),w(),o(1,"svg",29),u(2,"path",30),l()()}}function ne(t,r){t&1&&(o(0,"div"),w(),o(1,"svg",31),u(2,"path",32)(3,"path",33),l()())}function le(t,r){if(t&1){let e=C();o(0,"input",26),x("change",function(i){f(e);let s=d(3);return _(s.onFileSelected(i))}),l(),m(1,oe,3,0,"button",27)(2,ne,4,0,"div")}if(t&2){let e=d(3);a(),p(e.isLoadingPhoto?2:1)}}function se(t,r){if(t&1){let e=C();o(0,"button",34),x("click",function(){let i=f(e).$implicit,s=d(4);return _(s.openPostCard(i))}),u(1,"app-post-card",35),l()}if(t&2){let e=r.$implicit;a(),b("isProfileView",!0)("post",e)}}function re(t,r){if(t&1&&(o(0,"div",18),I(1,se,2,2,"button",null,W),l()),t&2){let e=d(3);a(),U(e.user.posts)}}function ae(t,r){t&1&&(o(0,"div",19)(1,"p",36),c(2,"There aren't posts yet"),l()())}function de(t,r){t&1&&(w(),o(0,"svg",21),u(1,"path",32)(2,"path",33),l())}function ce(t,r){if(t&1){let e=C();o(0,"div",4),x("scroll",function(i){f(e);let s=d(2);return _(s.onScroll(i))}),o(1,"div",5)(2,"div",6)(3,"div",7),m(4,X,1,1,"img",8)(5,Y,1,1,"img",8),l(),m(6,ie,2,1)(7,le,3,1),l(),o(8,"div",9)(9,"div",10)(10,"p",11),c(11),l(),o(12,"p",12),c(13),l()(),o(14,"div",13)(15,"div",14)(16,"p",15),c(17),l(),o(18,"p",15),c(19),l(),o(20,"p",15),c(21),l()(),o(22,"div",16)(23,"p"),c(24,"Posts"),l(),o(25,"p"),c(26,"Followers"),l(),o(27,"p"),c(28,"Following"),l()()()()(),o(29,"div",17),m(30,re,3,0,"div",18)(31,ae,3,0,"div",19),o(32,"diV",20),m(33,de,3,0,":svg:svg",21),l()()()}if(t&2){let e=d(2);a(4),p(e.user.photoUrl?4:5),a(2),p(e.store.user().username&&e.store.user().username!=e.user.username?6:e.store.user().username?7:-1),a(5),T(" ",e.user.username," "),a(2),T(" ",e.user.fullname," "),a(4),h(e.user.postCounter||"0"),a(2),h(e.user.followers||"0"),a(2),h(e.user.following||"0"),a(9),p(e.user.posts.length?30:31),a(3),p(e.loadingPosts?33:-1)}}function me(t,r){t&1&&(o(0,"div",3)(1,"p",37),c(2),l()()),t&2&&(a(2),h("User Not Found =("))}function pe(t,r){if(t&1&&m(0,ce,34,9,"div",2)(1,me,3,1,"div",3),t&2){let e=d();p(e.userNotFound?1:0)}}function ue(t,r){t&1&&u(0,"app-loading-screen")}var Ue=(()=>{class t{route;s3Uploader;imageResizer;subscription;constructor(e,n,i){this.route=e,this.s3Uploader=n,this.imageResizer=i}postCardContainer;isFollowing=!1;truncateDescription=q;postDate=K;loadingPosts=!1;queryExecuted=!1;postsService=g(N);onScroll(e){let n=e.target;n.scrollHeight-n.scrollTop<n.clientHeight+500&&!this.queryExecuted&&this.user.lastPostKey&&(this.loadingPosts=!0,this.queryExecuted=!0,this.postsService.getPostsByUser(this.user.lastPostKey).subscribe({next:s=>{if(s.posts.length){console.log("responde, ",s.posts);let F=this.user.posts.concat(s.posts);this.user.posts=F,this.user.lastPostKey=s.lastEvaluatedKey,this.queryExecuted=!1,this.loadingPosts=!1}},error:s=>{console.log(s),this.queryExecuted=!1,this.loadingPosts=!1,this.user.lastPostKey=""}}))}user={username:"",fullname:"",photoUrl:"",followers:0,following:0,postCounter:0,posts:[],lastPostKey:""};isLoading=!1;isLoadingPhoto=!1;userNotFound=!1;post={username:"",postId:"",imageUrl:"",description:"",timeStamp:0,likesQuantity:0,commentsQuantity:0,initialCommentsQuantity:0};isPostCardOpen=!1;showCommentsButton=!1;openPostCard(e){this.postCardContainer.nativeElement.scrollTop=0,this.post=e,this.post.initialCommentsQuantity=e.commentsQuantity,e.description.length>75?this.post.shortDescription=this.truncateDescription(e.description,75):this.post.shortDescription=e.description,e.commentsQuantity>0&&(this.showCommentsButton=!0),this.isPostCardOpen=!0}closePostCard(){this.isPostCardOpen=!1,this.showCommentsButton=!1}usersService=g(k);store=g(M);followUser(){this.usersService.followUser(this.user.username).subscribe({next:e=>{console.log(e),this.isFollowing=!0,this.user.followers=e.followers},error:e=>{console.log(e)}})}unfollowUser(){this.usersService.unfollowUser(this.user.username).subscribe({next:e=>{console.log(e),this.isFollowing=!1,this.user.followers=e.followers},error:e=>{console.log(e)}})}selectedFile=null;onFileSelected(e){return y(this,null,function*(){if(e.target&&e.target.files.length)if(e.target.files[0].type.match(/image\/*/)){let n=e.target.files[0];console.log("se cargo un archivo"),yield this.uploadFile(n)}else this.selectedFile=null})}triggerFileInput(){document.getElementById("fileInput").click()}profile=R.PROFILE;photoUrl="";uploadFile(e){return y(this,null,function*(){if(e){let n=yield this.imageResizer.resizeImage(e,400,400);console.log("Normal Image"),console.log(e.size),console.log("Image resized"),console.log(n.size),this.user.photoUrl="",this.isLoadingPhoto=!0,this.s3Uploader.uploadFile(n,this.profile).then(i=>{this.usersService.updateProfilePhoto(i).subscribe({next:s=>{console.log(s),Q(s.jwt),this.store.setPhoto(i),this.user.photoUrl=i,this.isLoadingPhoto=!1},error:s=>{console.log(s),this.isLoadingPhoto=!1}})}).catch(i=>{console.log(i),this.isLoadingPhoto=!1})}else console.log("no hay archivo")})}textoFormateado="";ngOnInit(){this.subscription=this.route.paramMap.subscribe(e=>{let n=e.get("username")||"";this.isLoading=!0,this.usersService.getUserProfile(n).subscribe({next:i=>{console.log("respuesta",i.user),this.user=i.user,this.isFollowing=i.isFollowing,this.isLoading=!1},error:i=>{console.log(i),this.userNotFound=!0,this.isLoading=!1}})})}static \u0275fac=function(n){return new(n||t)(v(O),v(G),v($))};static \u0275cmp=V({type:t,selectors:[["app-profile"]],viewQuery:function(n,i){if(n&1&&L(J,5),n&2){let s;j(s=z())&&(i.postCardContainer=s.first)}},standalone:!0,features:[B([k]),D],decls:6,vars:10,consts:[["postCardContainer",""],[1,"flex","mx-5","my-5","w-11/12","sm:w-9/12","md:w-10/12","lg:w-6/12",3,"closePostDetailsEmitter","isPostCardOpen","post","showCommentsButton"],[1,"flex","flex-col","items-center","w-full","px-4","py-10","sm:p-16","h-dvh","overflow-y-auto"],[1,"flex","flex-col","items-center","mt-40","w-full","h-dvh"],[1,"flex","flex-col","items-center","w-full","px-4","py-10","sm:p-16","h-dvh","overflow-y-auto",3,"scroll"],[1,"flex","w-full","sm:w-8/12","md:w-10/12","lg:w-6/12","h-min"],[1,"flex","flex-col","sm:justify-center","items-center","w-5/12","h-36","md:h-56"],[1,"flex","flex-col","h-3/4","justify-center"],["alt","Logo",1,"w-28","h-28","md:w-44","md:h-44","rounded-full","object-cover","shadow-lg",3,"src"],[1,"flex","flex-col","w-7/12","h-36","md:h-56","md:pt-4","pl-4","gap-6"],[1,"flex","flex-col","w-full"],[1,"font-bold","text-gray-heavy","text-2xl","md:mb-2","md:text-3xl"],[1,"font-bold","text-gray-heavy","text-base","md:text-lg"],[1,"flex","flex-row","w-full","gap-2"],[1,"flex","flex-col","items-start","font-extrabold","text-gray-heavy","text-sm","sm:text-base"],[1,"font-extrabold"],[1,"font-bold","text-gray-heavy","text-sm","sm:text-base"],[1,"flex","flex-col"],[1,"grid","grid-cols-1","w-[25rem]","md:grid-cols-2","md:w-[37rem]","lg:grid-cols-3","lg:w-[55rem]","mt-10","mb-3","sm:mb-14"],[1,"flex","w-full","justify-center","mt-20"],[1,"flex","flex-col","w-full","h-16","items-center","sm:justify-center","mb-10"],["aria-hidden","true","viewBox","0 0 100 101","fill","none","xmlns","http://www.w3.org/2000/svg",1,"inline","w-5","h-5","sm:w-10","sm:h-10","text-gray-dark","animate-spin","dark:text-gray-600","fill-gray-heavy"],[1,"flex","h-1/4","justify-center","items-center","p-2"],[1,"flex","h-1/4","justify-center","items-center","p-2",3,"click"],[1,"text-xs","md:text-sm","button-light","py-0.5","px-2","md:py-1","md:px-4"],[1,"text-xs","md:text-sm","button-light","py-0.5","px-2","md:py-1","md:px-4",3,"click"],["type","file","id","fileInput","accept","image/*","hidden","",3,"change"],[1,"bg-black","hover:bg-gray-hover","p-0.5","rounded-md","mt-2"],[1,"bg-black","hover:bg-gray-hover","p-0.5","rounded-md","mt-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-3","md:size-5","text-white"],["stroke-linecap","round","stroke-linejoin","round","d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"],["aria-hidden","true","viewBox","0 0 100 101","fill","none","xmlns","http://www.w3.org/2000/svg",1,"inline","w-4","h-4","text-gray-dark","animate-spin","dark:text-gray-600","fill-gray-heavy"],["d","M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z","fill","currentColor"],["d","M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z","fill","currentFill"],[3,"click"],[3,"isProfileView","post"],[1,"text-lg","md:text-xl","text-gray-dark"],[1,"text-2xl","md:text-4xl","text-gray-dark"]],template:function(n,i){if(n&1){let s=C();m(0,pe,2,1)(1,ue,1,0,"app-loading-screen"),u(2,"div"),o(3,"div",null,0)(5,"app-post-view",1),x("closePostDetailsEmitter",function(){return f(s),_(i.closePostCard())}),l()()}n&2&&(p(i.isLoading?1:0),a(2),S("fixed flex top-0 left-0 justify-center h-dvh w-full  transition ease-in-out duration-500   bg-black ",i.isPostCardOpen?"opacity-60 visible":"opacity-0 invisible",""),a(),S("fixed flex top-0 left-0 pb-24 justify-center h-dvh w-full transition ease-in-out duration-500 overflow-y-auto ",i.isPostCardOpen?"opacity-1 visible":"opacity-0 invisible",""),a(2),b("isPostCardOpen",i.isPostCardOpen)("post",i.post)("showCommentsButton",i.showCommentsButton))},dependencies:[A,H,Z]})}return t})();export{Ue as default};
